-- Catnip Auto Serverhopper (with Persistent Settings via JSON)
-- github.com/gabadagabadgoo/massmurder/job (raw)

-- Load or initialize global settings
getgenv().CatnipSettings = getgenv().CatnipSettings or {
    SelectedRarities = {},
    AutoHop = false
}

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- GUI Setup
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "CatnipAutoHopper"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 300, 0, 430)
frame.Position = UDim2.new(0.5, -150, 0.5, -215)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 40)
title.Text = "üêæ Catnip's Auto Serverhopper"
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextColor3 = Color3.new(1, 1, 1)
title.BackgroundTransparency = 1

local container = Instance.new("Frame", frame)
container.Size = UDim2.new(1, -20, 1, -90)
container.Position = UDim2.new(0, 10, 0, 50)
container.BackgroundTransparency = 1

local layout = Instance.new("UIListLayout", container)
layout.Padding = UDim.new(0, 4)

local rarities = { "Transcendant", "Celestial", "Divine", "Ascended", "Mythic", "Legendary", "Epic", "Rare", "Uncommon", "Common" }

local function createRarityToggle(rarity)
    local toggle = Instance.new("TextButton")
    toggle.Size = UDim2.new(1, 0, 0, 30)
    toggle.Text = "[ ] " .. rarity
    toggle.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    toggle.TextColor3 = Color3.new(1, 1, 1)
    toggle.Font = Enum.Font.Gotham
    toggle.TextSize = 14
    toggle.Parent = container

    local selected = getgenv().CatnipSettings.SelectedRarities[rarity] or false
    toggle.Text = selected and "[‚úì] " .. rarity or "[ ] " .. rarity

    toggle.MouseButton1Click:Connect(function()
        selected = not selected
        getgenv().CatnipSettings.SelectedRarities[rarity] = selected
        toggle.Text = selected and "[‚úì] " .. rarity or "[ ] " .. rarity
    end)
end

for _, rarity in ipairs(rarities) do
    createRarityToggle(rarity)
end

-- START/STOP button
local hopButton = Instance.new("TextButton", frame)
hopButton.Size = UDim2.new(1, -20, 0, 40)
hopButton.Position = UDim2.new(0, 10, 1, -45)
hopButton.Text = getgenv().CatnipSettings.AutoHop and "‚è∏Ô∏è Pause Hopping" or "üöÄ Start Hopping"
hopButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
hopButton.TextColor3 = Color3.new(1, 1, 1)
hopButton.Font = Enum.Font.GothamBold
hopButton.TextSize = 16
Instance.new("UICorner", hopButton).CornerRadius = UDim.new(0, 8)

-- Utility
local function getRarityRank(rarity)
    local order = {
        Transcendant = 1, Celestial = 2, Divine = 3, Ascended = 4,
        Mythic = 5, Legendary = 6, Epic = 7, Rare = 8,
        Uncommon = 9, Common = 10
    }
    return order[rarity] or 999
end

-- ESP Check
local function findBestBaddie()
    local best = 999
    local found = nil
    for _, model in ipairs(workspace:GetDescendants()) do
        if model:IsA("Model") and model:FindFirstChildWhichIsA("Humanoid") then
            for _, label in ipairs(model:GetDescendants()) do
                if label:IsA("TextLabel") then
                    for rarity, selected in pairs(getgenv().CatnipSettings.SelectedRarities) do
                        if selected and label.Text:find(rarity) then
                            local rank = getRarityRank(rarity)
                            if rank < best then
                                best = rank
                                found = model
                            end
                        end
                    end
                end
            end
        end
    end
    return found
end

-- Server hop util
local function getRandomServer()
    local servers = HttpService:JSONDecode(
        game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100")
    )
    local currentJobId = game.JobId
    for _, server in pairs(servers.data) do
        if server.playing < server.maxPlayers and server.id ~= currentJobId then
            return server.id
        end
    end
    return nil
end

-- Server hop
local function hopIfNeeded()
    if getgenv().CatnipSettings.AutoHop and not findBestBaddie() then
        local settingsJSON = HttpService:JSONEncode(getgenv().CatnipSettings)
        local teleportScript = ([[
            getgenv().CatnipSettings = %s
            loadstring(game:HttpGet("https://raw.githubusercontent.com/gabadagabadgoo/massmurder/main/job"))()
        ]]):format(settingsJSON)
        queue_on_teleport(teleportScript)

        local nextServer = getRandomServer()
        if nextServer then
            TeleportService:TeleportToPlaceInstance(game.PlaceId, nextServer)
        end
    end
end

-- Button logic
hopButton.MouseButton1Click:Connect(function()
    getgenv().CatnipSettings.AutoHop = not getgenv().CatnipSettings.AutoHop
    hopButton.Text = getgenv().CatnipSettings.AutoHop and "‚è∏Ô∏è Pause Hopping" or "üöÄ Start Hopping"
    hopIfNeeded()
end)

-- Auto hop if toggled
task.delay(1, function()
    if getgenv().CatnipSettings.AutoHop then
        hopIfNeeded()
    end
end)
